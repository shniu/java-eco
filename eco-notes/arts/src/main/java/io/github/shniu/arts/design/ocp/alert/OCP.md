# OCP 设计原则

OCP：Open-Closed Principle

## Example

### 告警系统的例子

- v1 版本

v1 版本是违反了 OCP 的代码实现，问题有如下几点：

1. 修改了 `Alert` 的接口定义，也就是对 `check` 函数增加了参数，这样会导致所有使用了该接口的地方都需要修改代码，增加了出错的可能，使得代码更加脆弱
2. 修改了 `check` 后，单元测试代码也要修改
3. 增加新的功能并没有扩展性，如果有很多规则，就要些非常多的if-else，增加更多的参数

- v2 版本

这个版本的代码在 v1 的基础之上进行重构，在扩展新功能时满足了 OCP，值得学习

1. 先对 v1 版本的代码做重构，引入 AlertHandler 的代码结构，这样增强了主干代码的稳定性
2. 增加新功能的扩展 TimeoutAlertHandler, 不需要修改主干代码 check 的逻辑，也不影响其他的 AlertHandler 实现
3. 不影响其他 Handler 的单元测试，只需要增加 TimeoutAlertHandler 的单测
4. 再增加新的告警规则也异常方便，已有的功能都是稳定的
